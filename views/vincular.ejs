<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../views/template/head %>
</head>
<body>

<nav>
	<% include ../views/template/nav %>
</nav>

	<h2>Vincular</h2>
	<form class="form-horizontal" method="post" action="/vincular">
     <div class="form-group">
         <label for="inputName" class="control-label col-xs-2">Nombre de Usuario:</label>
         <div class="col-xs-10">
             <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Nombre">
         </div>
     </div>
     <div class="form-group">
         <label for="inputEmail" class="control-label col-xs-2">Mac Pi:</label>
         <div class="col-xs-10">
             <input type="text" id="mac" name="mac" class="form-control" placeholder="Mac Pi">
         </div>
     </div>
     <div class="form-group">
         <label for="inputPassword" class="control-label col-xs-2">Nº Serie:</label>
         <div class="col-xs-10">
             <input type="text" id="nserie" name="nserie" class="form-control" placeholder="Nº Serie">
         </div>
     </div>
     <div class="form-group">
         <div class="col-xs-offset-2 col-xs-10">
             <button type="submit" class="btn btn-primary">Enviar</button>
         </div>
     </div>
</form>

<video id="video" width="300" height="250" autoplay></video>


<canvas id="canvas" width="300" height="250"></canvas>

<h6 class="center">Result</h6>
    <span id="read" class="center"></span>
    <br>

<script src="javascripts/html5-qrcode.min.js"></script>

<script type="text/javascript">
    
    // Put event listeners into place
window.addEventListener("DOMContentLoaded", function() {
    // Grab elements, create settings, etc.
    var canvas = document.getElementById("canvas"),
        context = canvas.getContext("2d"),
        video = document.getElementById("video"),
        videoObj = { "video": true },
        errBack = function(error) {
            console.log("Video capture error: ", error.code); 
        };

    // Put video listeners into place
    if(navigator.getUserMedia) { // Standard
        navigator.getUserMedia(videoObj, function(stream) {
            video.src = stream;
            video.play();
        }, errBack);
    } else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
        navigator.webkitGetUserMedia(videoObj, function(stream){
            video.src = window.webkitURL.createObjectURL(stream);
            video.play();
        }, errBack);
    }
    else if(navigator.mozGetUserMedia) { // Firefox-prefixed
        navigator.mozGetUserMedia(videoObj, function(stream){
            video.src = window.URL.createObjectURL(stream);
            video.play();
        }, errBack);
    }
}, false);

// Trigger photo take
document.getElementById("snap").addEventListener("click", function() {
    context.drawImage(video, 0, 0, 640, 480);
});
</script>
<script type="text/javascript">
    $(document).ready(function(){
    $('#canvas').html5_qrcode(function(data){
            $('#read').html(data);
        },
        function(error){
            $('#read_error').html(error);
        }, function(videoError){
            $('#vid_error').html(videoError);
        }
    );
});
</script>
    
</body>
</html>



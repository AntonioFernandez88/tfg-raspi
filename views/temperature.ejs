<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="en">

<% include ../views/template/head %>
<script src="javascripts/canvasjs.min.js"></script>
<script src="javascripts/jquery.canvasjs.min.js"></script>
<script type="text/javascript">
  window.onload = function () {

    var seg = []; // dataPoints

    var chart = new CanvasJS.Chart("chartContainer",{
      title :{
        text: "Temperatura"
      },
      data: [{
        type: "line",
        dataPoints: seg
      }]
    });

    var ws = new WebSocket("ws://serverwss.herokuapp.com/");
    ws.onopen = function(){
        console.log("Connection is open...");
    };
    ws.onclose = function(){
        console.log("Connection is closed");
    };

    var xVal = 0;
    ws.onmessage = function (event) {
      console.log(event.data);
      var json = {y: 1};
      var dataLength = 60; // number of dataPoints visible at any point

      seg.push({
        x: xVal,
        y: json.y
      });
      xVal++;

      if (seg.length > dataLength) {
        seg.shift();
      }

      chart.render();
    };
  }
</script>
</head>
<body>
  <nav class="navbar navbar-inverse">
    <% include ../views/template/nav %>
  </nav>
  <div id="content">
    <form method="get" action="/temperature">
      <script type="text/javascript">
        var id = $.get("id");
        var valorCookie = Cookies.getJSON('pi');
        document.write('<input type="hidden" id="id" name="id" value="'+ id +'">');
        document.write('<input type="hidden" id="mac" name="mac" value="'+ valorCookie[id].mac +'">');
      </script>
      <h1>Temperatura</h1>
      </form>
      <div id="chartContainer" style="height: 300px; width:100%;">
    </div>
    <% include ../views/template/footer %>
